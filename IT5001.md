## **运算优先级**

| 优先级 | 运算符/表达式                                                | 说明说明                                |
| ------ | ------------------------------------------------------------ | --------------------------------------- |
| 1      | `()`, `[]`, `.`                                              | 表达式调用、索引、切片、属性访问        |
| 2      | `await`                                                      | 异步上下文中使用                        |
| 3      | `**`                                                         | 指数运算（右结合）                      |
| 4      | `+x`、`-x`、`~x`                                             | 一元运算符（正号、负号、按位取反）      |
| 5      | `*`、`/`、`//`、`%`                                          | 乘法、除法、整除、取余                  |
| 6      | `+`、`-`                                                     | 加法、减法                              |
| 7      | `<<`、`>>`                                                   | 位移运算（左移、右移）                  |
| 8      | `&`                                                          | 按位与                                  |
| 9      | `^`                                                          | 按位异或                                |
| 10     | `|`                                                          | 按位或                                  |
| 11     | `<`、`<=`、`>`、`>=`、`==`、`!=`、`is`、`is not`、`in`、`not in` | 比较运算、身份与成员运算（可链式比较）  |
| 12     | `not`                                                        | 布尔非                                  |
| 13     | `and`                                                        | 布尔与                                  |
| 14     | `or`                                                         | 布尔或                                  |
| 15     | `a if condition else b`                                      | 条件表达式（三元表达式）                |
| 16     | `lambda`                                                     | Lambda 表达式（所有运算符中优先级最低） |

其中右结合的为

1. 指数运算 **
2. 条件表达式和lambda表达式

```python
2 ** 3 ** 2 # 2 ** (3 ** 2)
x if cond1 else y if cond2 else z # x if cond1 else (y if cond2 else z)
lambda x: lambda y: x + y # lambda x: (lambda y: x + y)
```

**and**：返回第一个假值（短路），若无假值则返回最后一个操作数。

**or**：返回第一个真值（短路），若无真值则返回最后一个操作数。

在 Python 中，下列值被视为 False（布尔假值），其他都视为 True（布尔真值）：

- **False 布尔值**：`False`
- **None**：表示“无值”
- **数值零**：`0`、`0.0`、`0j` 等
- **空序列和容器**：空字符串 `""`、空列表 `[]`、空元组 `()`、空字典 `{}`、空集合 `set()` 等

布尔值 `True` 在数值运算中相当于整数 `1`。

`int(x)` 将数字转换为整数时，只截取小数点前的部分，不做四舍五入，类似于向零取整（truncation）。

int(3.7)    # 结果: 3

int(-3.7)   # 结果: -3

`round(x[, ndigits])` 默认采用“银行家舍入法”（round-half-to-even）：

- 当小数部分正好为 0.5 时，取最近的偶数。
- 其他情况则进行通常的四舍五入。

round(2.5)    # 结果: 2，因为 2 是偶数 

round(3.5)    # 结果: 4，因为 4 是偶数

`//` 运算符返回商的整数部分，但它实际上是**向下取整**（floor division）：

- 对于正数，效果与截断相同；
- 对于负数，结果会“更小”（即更负），因为它取小于或等于真实商的最大整数。

7 // 2     # 结果: 3，因为 7/2 = 3.5，向下取整为 3 

-7 // 2    # 结果: -4，因为 -7/2 = -3.5，向下取整为 -4

## list

### 初始化

```python
chars = list("hello")  # ['h', 'e', 'l', 'l', 'o']
tpl = (1, 2, 3)
numbers = list(tpl)  # [1, 2, 3]
# 生成器表达式转换为列表
gen = (x for x in range(5))
numbers = list(gen)  # [0, 1, 2, 3, 4]
# 浅拷贝
original = [1, 2, 3]
copy_list = original[:]       # 使用切片
copy_list = list(original)    # 使用 list() 函数
# 深拷贝 用于嵌套列表
import copy
nested = [[1, 2], [3, 4]]
deep_copy = copy.deepcopy(nested)
```

下面是一份关于 Python 列表常用方法的详细说明，包括它们的作用、返回值以及相关注意事项：

| 方法                              | 作用                                                         | 返回值       | 说明                                                         |
| --------------------------------- | ------------------------------------------------------------ | ------------ | ------------------------------------------------------------ |
| **append(x)**                     | 在列表末尾添加元素 `x`                                       | `None`       | 直接修改原列表，不返回新列表。                               |
| **extend(iterable)**              | 将可迭代对象（如列表、元组、字符串等）的所有元素添加到当前列表末尾 | `None`       | 直接修改原列表。                                             |
| **insert(i, x)**                  | 在索引 `i` 处插入元素 `x`                                    | `None`       | 索引 `i` 超出范围时会自动调整到合适位置。                    |
| **remove(x)**                     | 删除列表中第一次出现的值为 `x` 的元素                        | `None`       | 如果 `x` 不在列表中会抛出 `ValueError`。                     |
| **pop([i])**                      | 删除并返回指定索引 `i` 处的元素，默认 `i=-1` 表示删除最后一个元素 | 被删除的元素 | 索引超出范围会抛出 `IndexError`。                            |
| **clear()**                       | 删除列表中的所有元素                                         | `None`       | 直接修改原列表，变为空列表。                                 |
| **index(x[, start[, end]])**      | 返回元素 `x` 在列表中第一次出现的索引，可指定查找范围 `[start, end)` | 整型索引     | 如果 `x` 不存在会抛出 `ValueError`。                         |
| **count(x)**                      | 统计 `x` 在列表中出现的次数                                  | 整型数字     | 无修改操作。                                                 |
| **sort(key=None, reverse=False)** | 对列表进行原地排序                                           | `None`       | 使用可选参数 `key` 指定排序规则，`reverse=True` 表示降序排序。 |
| **reverse()**                     | 对列表进行原地反转                                           | `None`       | 直接修改原列表。                                             |
| **copy()**                        | 返回当前列表的浅拷贝                                         | 新列表对象   | 返回一个新的列表，原列表不受影响。                           |

## tuple

```python
# 单元素初始化
t = (1,)
# 省略括号
t = 1, 2, 3
single = 1,  # 等同于 (1,)
t = tuple([1, 2, 3])  # 结果: (1, 2, 3)
t_from_str = tuple("abc")  # 结果: ('a', 'b', 'c')
```

| 方法                       | 作用                                                  | 返回值   | 说明                               |
| -------------------------- | ----------------------------------------------------- | -------- | ---------------------------------- |
| **count(x)**               | 统计元素 `x` 在元组中出现的次数                       | 整数     | 返回 `x` 出现的次数，不改变原元组  |
| **index(x, [start, end])** | 返回元素 `x` 在元组中第一次出现的索引，可指定查找范围 | 整型索引 | 如果 `x` 不存在会抛出 `ValueError` |

元组是不可变的，因此如果其所有元素也都是不可变的，那么这个元组可以作为字典的键或存放在集合中。如果元组中含有可变元素，则不能作为哈希对象。

t1 = (1, 2, 3)

 d = {t1: "value"}  # 正确

t2 = ([1, 2], 3) 

d = {t2: "value"}  # 报错，因为列表不可哈希

## set

```python
# 从列表创建集合（重复元素会被自动去重）
s = set([1, 2, 2, 3, 4])  # 得到 {1, 2, 3, 4}
s = set("hello")  # 可能得到 {'e', 'h', 'l', 'o'}，注意顺序不固定
s = set((1, 2, 3))
s = {x * x for x in range(5)}  # 得到 {0, 1, 4, 9, 16}
```

| 方法                            | 作用                                                         | 返回值                  | 注意事项                                                     |
| ------------------------------- | ------------------------------------------------------------ | ----------------------- | ------------------------------------------------------------ |
| **add(elem)**                   | 向集合中添加单个元素                                         | `None`                  | 如果元素已存在，不会有任何改变。                             |
| **update(\*others)**            | 将多个集合或可迭代对象中的元素添加到当前集合                 | `None`                  | 可接受多个参数，元素会自动去重。                             |
| **remove(elem)**                | 删除集合中指定的元素                                         | `None`                  | 若元素不存在，会引发 `KeyError` 异常。                       |
| **discard(elem)**               | 删除集合中指定的元素                                         | `None`                  | 若元素不存在，不会引发异常。                                 |
| **pop()**                       | 随机删除并返回集合中的一个元素                               | 被删除的元素            | 由于集合无序，返回的是任意元素；若集合为空会引发 `KeyError`。 |
| **clear()**                     | 清空集合中所有元素                                           | `None`                  | 直接修改原集合，变为空集合。                                 |
| **union(\*others)**             | 返回当前集合与其他集合或可迭代对象的并集                     | 新集合                  | 不改变原集合；等同于操作符 `                                 |
| **intersection(\*others)**      | 返回当前集合与其他集合或可迭代对象的交集                     | 新集合                  | 不改变原集合；等同于操作符 `&`。                             |
| **difference(\*others)**        | 返回当前集合与其他集合或可迭代对象的差集                     | 新集合                  | 不改变原集合；等同于操作符 `-`。                             |
| **symmetric_difference(other)** | 返回当前集合与另一个集合的对称差集（即不同时包含于两个集合的元素） | 新集合                  | 不改变原集合；等同于操作符 `^`。                             |
| **isdisjoint(other)**           | 判断当前集合与其他集合是否没有交集                           | 布尔值 (`True`/`False`) | 若两个集合没有共同元素，则返回 `True`。                      |
| **issubset(other)**             | 判断当前集合是否是其他集合的子集                             | 布尔值 (`True`/`False`) | 等同于操作符 `<=`。                                          |
| **issuperset(other)**           | 判断当前集合是否是其他集合的超集                             | 布尔值 (`True`/`False`) | 等同于操作符 `>=`。                                          |
| **copy()**                      | 返回集合的浅拷贝                                             | 新集合                  | 生成与原集合内容相同的独立集合。                             |

**只能包含可哈希（不可变）的元素**

- 集合的元素必须是可哈希的，即不可变的数据类型。常见的可哈希类型有数字、字符串、元组（前提是元组内部元素也都是不可变的）。例如，不能将列表、字典等可变类型放入集合中，否则会抛出 `TypeError`。

## dict

```python
pairs = [("name", "Bob"), ("age", 30)]
d = dict(pairs)  # 结果: {'name': 'Bob', 'age': 30}
d = dict(name="Charlie", age=22) # 结果: {'name': 'Charlie', 'age': 22}
d = {x: x*x for x in range(1, 6)}# 结果: {1: 1, 2: 4, 3: 9, 4: 16, 5: 25}
```

**键的要求**：字典中的键必须是不可变类型（如字符串、数字、元组），而值可以是任意对象。

**空字典**：不能用 `{}` 和字面量表示空集合，因为 `{}` 表示空字典，空集合需要用 `set()`。

下面是一份关于 Python 字典常用方法的详细说明，包括它们的作用、返回值以及注意事项：

| 方法                               | 作用                                                         | 返回值                       | 说明                                                         |
| ---------------------------------- | ------------------------------------------------------------ | ---------------------------- | ------------------------------------------------------------ |
| **clear()**                        | 清空字典中所有键值对                                         | `None`                       | 直接修改原字典，将字典变为空字典。                           |
| **copy()**                         | 返回字典的浅拷贝                                             | 新字典对象                   | 创建与原字典相同的一个新字典，但只做浅拷贝（嵌套对象不会被复制）。 |
| **fromkeys(iterable, value=None)** | 根据可迭代对象中的元素作为键，创建一个新字典，所有键的初始值都为 `value` | 新字典对象                   | 是一个类方法，常用于快速生成具有相同默认值的字典。           |
| **get(key, default=None)**         | 根据键获取对应的值，如果键不存在，则返回 `default`           | 对应键的值或 `default`       | 不会抛出 `KeyError` 异常，适用于安全地获取键对应的值。       |
| **items()**                        | 返回包含字典中所有键值对的视图对象                           | `dict_items` 视图对象        | 视图对象会实时反映字典的变化，通常可用于遍历。               |
| **keys()**                         | 返回包含字典中所有键的视图对象                               | `dict_keys` 视图对象         | 同样为动态视图，可用于检查字典中是否存在某个键。             |
| **values()**                       | 返回包含字典中所有值的视图对象                               | `dict_values` 视图对象       | 用于遍历或检查字典中的所有值。                               |
| **pop(key, default=...)**          | 删除指定键并返回对应的值                                     | 被删除的值或 `default`       | 如果指定键不存在且未提供默认值，将抛出 `KeyError`。          |
| **popitem()**                      | 随机删除并返回字典中的一对键值对                             | 被删除的 `(key, value)` 元组 | 在 Python 3.7+ 中，通常删除的是最后插入的项；字典为空时会抛出 `KeyError`。 |
| **setdefault(key, default=None)**  | 如果键存在则返回其值；否则将键设为 `default` 并返回 `default` | 键对应的值或 `default`       | 既能获取键值，又能在键不存在时设置默认值。                   |
| **update([other])**                | 使用另一个字典或可迭代对象中的键值对更新当前字典             | `None`                       | 直接修改原字典，将其他字典中的键值对合并进来，如果键冲突则覆盖。 |

## lambda 表达式

**闭包和延迟绑定问题**：

在循环中使用 lambda 创建闭包时，容易遇到绑定问题。例如：

funcs = [lambda x: x + i for i in range(5)] 

print([f(10) for f in funcs])  # 预期可能是 [10, 11, 12, 13, 14]

实际上会输出 `[14, 14, 14, 14, 14]`，因为 lambda 捕获的是变量 `i` 的引用，而不是其当时的值。解决方法可以使用默认参数：

funcs = [lambda x, i=i: x + i for i in range(5)] 

print([f(10) for f in funcs])  # 正确输出: [10, 11, 12, 13, 14]

**Y 组合子**

```py
Y = (lambda f: (lambda x: f(lambda v: x(x)(v)))(lambda x: f(lambda v: x(x)(v))))
fact = (lambda f: (lambda i: 1 if (i == 0) else i * f(i - 1)))
F = Y(fact)
(lambda f: (lambda x: f(lambda v: x(x)(v)))(lambda x: f(lambda v: x(x)(v))))(lambda f: (lambda i: f(i - 1) + f(i - 2) if i > 1 else 1))(5)
```

`map` 接受一个函数和一个或多个可迭代对象，将该函数依次应用到可迭代对象的每个元素上，并返回一个迭代器，包含所有计算结果。

```python
map(function, iterable, ...)
a = [1, 2, 3]
b = [10, 20, 30]
result = map(lambda x, y: x + y, a, b)
print(list(result))  # 输出: [11, 22, 33]
```

`filter` 接受一个函数和一个可迭代对象，函数用于判断每个元素是否符合条件，返回一个迭代器，包含所有使得函数返回 `True` 的元素。

```python
filter(function, iterable)
# 过滤出列表中的偶数
nums = [1, 2, 3, 4, 5, 6]
evens = filter(lambda x: x % 2 == 0, nums)
print(list(evens))  # 输出: [2, 4, 6]
# 如果函数为 None，则直接过滤出所有逻辑上为 True 的元素：
data = [0, 1, '', 'hello', [], [1, 2]]
filtered = filter(None, data)
print(list(filtered))  # 输出: [1, 'hello', [1, 2]]
```

`reduce` 用于对一个序列进行累积计算，它将函数连续作用于序列的前两个元素，再将结果与下一个元素继续计算，直到处理完整个序列，返回一个最终结果。

```python
from functools import reduce
reduce(function, iterable[, initializer])
from functools import reduce

# 求列表所有数字的乘积
nums = [1, 2, 3, 4]
product = reduce(lambda x, y: x * y, nums)
print(product)  # 输出: 24

nums = [1, 2, 3, 4]
# 初始值为10，则计算过程为：(((10 * 1) * 2) * 3) * 4 = 240
product = reduce(lambda x, y: x * y, nums, 10)
print(product)  # 输出: 240
```

